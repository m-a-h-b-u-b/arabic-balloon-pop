<!-- 
Arabic Language Learning Ballon Pop Game 
----------------------------------------
License : Apache 2.0 License
Author  : Md Mahbubur Rahman
URL     : https://m-a-h-b-u-b.github.io
GitHub  : https://github.com/m-a-h-b-u-b/arabic-balloon-pop
-->
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Arabic Balloon Pop Game</title>
<style>
html, body { margin:0; height:100%; background:#87ceeb; font-family:Arial; display:flex; justify-content:center; align-items:flex-start; overflow:hidden; }
#gameContainer { position:relative; display:flex; align-items:flex-start; }
#gameCanvas { background: linear-gradient(#87ceeb,#fff); border:3px solid #333; margin-right:220px; }
#ui { margin-bottom:10px; color:#333; font-size:20px; display:flex; gap:15px; display:none; }
button { cursor:pointer; padding:8px 12px; font-size:16px; border-radius:6px; border:none; }
#meaningPopup, #reviewPopup { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(255,255,255,0.95); padding:15px 25px; border:2px solid #333; font-size:20px; color:#000; border-radius:8px; display:none; text-align:center; z-index:10; max-width:90%; }
#categorySelect { margin-bottom:20px; font-size:18px; }
#hintPanel { position:absolute; top:50px; right:20px; width:200px; background:rgba(255,255,255,0.9); padding:15px; border:4px solid #333; border-radius:8px; font-size:18px; text-align:center; }
#currentMeaning { margin-top:10px; font-size:20px; color:#000; }
</style>
</head>
<body>
<div id="gameContainer">
  <div style="display:flex;flex-direction:column;align-items:center;">
    <select id="categorySelect">
      <option value="">Select Category</option>
      <option value="names">Names of Allah</option>
      <option value="hajj">Hajj Terms</option>
      <option value="places">Quranic Places</option>
      <option value="verbs">Quranic Verbs</option>
    </select>
    <button id="startBtn">Start Game</button>
    <div id="ui">
      Score: <span id="score">0</span>
      Time: <span id="timer">180</span>s
      Lives: <span id="lives">3</span>
      <button id="freezeBtn">Freeze Time</button>
      <button id="doubleBtn">Double Points</button>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="meaningPopup"></div>
    <div id="reviewPopup"></div>
  </div>
  <div id="hintPanel">
    <strong>Pop this word:</strong>
    <div id="currentMeaning"></div>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const livesEl = document.getElementById('lives');
const popup = document.getElementById('meaningPopup');
const reviewPopup = document.getElementById('reviewPopup');
const freezeBtn = document.getElementById('freezeBtn');
const doubleBtn = document.getElementById('doubleBtn');
const startBtn = document.getElementById('startBtn');
const categorySelect = document.getElementById('categorySelect');

let balloons = [], particles = [];
let score = 0, timeLeft = 60, balloonSpeed = 1.5;
let freezeTime = false, doublePoints = false, lives = 3;
let learnedWords = [], currentWord = null, categoryWords = [];

// Word Lists
const allWords = {
  names:[{word:"الله",meaning:"Allah"},{word:"الرحمن",meaning:"The Most Merciful"},{word:"الرحيم",meaning:"The Most Compassionate"},{word:"الملك",meaning:"The King"},{word:"القدوس",meaning:"The Holy"},{word:"السلام",meaning:"The Source of Peace"},{word:"المؤمن",meaning:"The Granter of Security"},{word:"العزيز",meaning:"The Almighty"},{word:"الجبار",meaning:"The Compeller"},{word:"المتكبر",meaning:"The Supreme"},{word:"الخالق",meaning:"The Creator"},{word:"البارئ",meaning:"The Evolver"}],
  hajj:[{word:"حج",meaning:"Hajj (Pilgrimage)"},{word:"عرفات",meaning:"Arafat"},{word:"مزدلفة",meaning:"Muzdalifah"},{word:"منى",meaning:"Mina"},{word:"رمي الجمرات",meaning:"Stoning of the Jamrah"},{word:"طواف",meaning:"Tawaf (Circumambulation)"},{word:"سعي",meaning:"Sa’i (between Safa & Marwah)"},{word:"إفاضة",meaning:"Departure from Arafat"},{word:"إحرام",meaning:"State of ritual purity"}],
  places:[{word:"مكة",meaning:"Mecca"},{word:"المدينة",meaning:"Medina"},{word:"بدر",meaning:"Badr"},{word:"أحد",meaning:"Uhud"},{word:"القدس",meaning:"Jerusalem"},{word:"بيت_المقدس",meaning:"Al-Aqsa"},{word:"مصر",meaning:"Egypt"},{word:"بابل",meaning:"Babylon"},{word:"طور",meaning:"Mount Sinai"},{word:"حِراء",meaning:"Hira"},{word:"صفا",meaning:"Safa"},{word:"مروة",meaning:"Marwah"},{word:"الكعبة",meaning:"Kaaba"}],
  verbs:[{word:"خلق",meaning:"Created"},{word:"قال",meaning:"Said"},{word:"جعل",meaning:"Made"},{word:"كتب",meaning:"Wrote"},{word:"أتى",meaning:"Came"},{word:"أرسل",meaning:"Sent"},{word:"علم",meaning:"Taught"},{word:"رزق",meaning:"Provided"},{word:"هدى",meaning:"Guided"},{word:"غفر",meaning:"Forgave"},{word:"رحم",meaning:"Had mercy"},{word:"أحسن",meaning:"Did good"},{word:"نصر",meaning:"Helped"},{word:"سمع",meaning:"Heard"},{word:"بصر",meaning:"Saw"}]
};

// Balloon Class
class Balloon {
  constructor(o) {
    this.word = o.word;
    this.meaning = o.meaning;
    this.radius = 40;
    this.y = canvas.height + 50;
    this.color = o.color || `hsl(${Math.random()*360},70%,60%)`;
    this.x = o.x;
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
    ctx.fillStyle = this.color;
    ctx.fill();
    ctx.strokeStyle = "#333";
    ctx.stroke();
    ctx.fillStyle="#000";
    ctx.font="30px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(this.word,this.x,this.y);
  }
  update(){if(!freezeTime) this.y -= balloonSpeed;}
}

// Particle class for pops
class Particle{
  constructor(x,y,color){
    this.x=x; this.y=y; this.vx=(Math.random()-0.5)*4; this.vy=(Math.random()-1.5)*4;
    this.alpha=1; this.radius=Math.random()*5+2; this.color=color;
  }
  draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);ctx.fillStyle=`rgba(${this.color.r},${this.color.g},${this.color.b},${this.alpha})`;ctx.fill();}
  update(){this.x+=this.vx; this.y+=this.vy; this.alpha-=0.03;}
}


// Show meaning popup
function showMeaning(text){
  popup.textContent=text;
  popup.style.display="block";
  setTimeout(()=>{popup.style.display="none";},1500);
}

// Show review
function showReview(){
  let html="<h3>Words Learned:</h3><ul>";
  learnedWords.forEach(w=>{html+=`<li>${w.word} - ${w.meaning}</li>`;});
  html+="</ul><button onclick='location.reload()'>Play Again</button>";
  reviewPopup.innerHTML=html;
  reviewPopup.style.display="block";
}

// Next word
function nextWord(){
  currentWord = categoryWords[Math.floor(Math.random()*categoryWords.length)];
  currentWord.color = `hsl(${Math.random()*360},70%,60%)`;
  document.getElementById('currentMeaning').textContent = currentWord.meaning;
  document.getElementById('hintPanel').style.borderColor = currentWord.color;
}

// Continuous balloon spawn
function spawnBalloonsLoop(){
  const maxOnScreen = 25;

  // Current word balloon
  if(!balloons.some(b=>b.word===currentWord.word)){
    let x, attempts=0;
    while(attempts<40){
      x = Math.random()*(canvas.width-80)+40;
      if(!balloons.some(b=>Math.abs(b.x-x)<80)) break;
      attempts++;
    }
    balloons.push(new Balloon({word: currentWord.word, meaning:currentWord.meaning, x:x, color:currentWord.color}));
  }

  // Random extra balloons
  if(balloons.length<maxOnScreen){
    const obj = categoryWords[Math.floor(Math.random()*categoryWords.length)];
    if(obj.word!==currentWord.word){
      let x, attempts=0;
      while(attempts<40){
        x = Math.random()*(canvas.width-80)+40;
        if(!balloons.some(b=>Math.abs(b.x-x)<80)) break;
        attempts++;
      }
      if(attempts<40){
        const color = `hsl(${Math.random()*360},70%,60%)`;
        balloons.push(new Balloon({word: obj.word, meaning:obj.meaning, x:x, color:color}));
      }
    }
  }

  requestAnimationFrame(spawnBalloonsLoop);
}

// Game loop
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  balloons.forEach((b,i)=>{b.update();b.draw(); if(b.y+b.radius<0) balloons.splice(i,1);});
  particles.forEach((p,i)=>{p.update();p.draw(); if(p.alpha<=0) particles.splice(i,1);});
  requestAnimationFrame(gameLoop);
}

// Timer
function startTimer(){
  const timer=setInterval(()=>{
    if(!freezeTime) timeLeft--;
    timerEl.textContent=timeLeft;
    if(timeLeft<=0 || lives<=0){
      clearInterval(timer);
      showReview();
    }
  },1000);
}

// Click detection
canvas.addEventListener('click',e=>{
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width/rect.width;
  const scaleY = canvas.height/rect.height;
  const mx = (e.clientX-rect.left)*scaleX;
  const my = (e.clientY-rect.top)*scaleY;

  balloons.forEach((b,i)=>{
    const dist = Math.hypot(mx-b.x,my-b.y);
    if(dist < b.radius){
      if(b.word===currentWord.word){
        // particles
        const rgb = b.color.match(/\d+/g) || [0,0,0];
        for(let j=0;j<15;j++) particles.push(new Particle(b.x,b.y,{r:rgb[0],g:rgb[1],b:rgb[2]}));

        balloons.splice(i,1);
        score += doublePoints?2:1;
        scoreEl.textContent=score;
        timeLeft +=10;
        learnedWords.push({word:b.word, meaning:b.meaning});
        showMeaning(b.meaning);
        balloonSpeed +=0.05;
        nextWord();
      } else {
        lives--;
        livesEl.textContent=lives;
      }
    }
  });
});

// Buttons
freezeBtn.addEventListener('click',()=>{
  freezeTime = !freezeTime;
  freezeBtn.textContent = freezeTime?"Unfreeze":"Freeze Time";
});
doubleBtn.addEventListener('click',()=>{
  doublePoints = !doublePoints;
  doubleBtn.textContent = doublePoints?"Normal Points":"Double Points";
});

// Start game
startBtn.addEventListener('click',()=>{
  const cat = categorySelect.value;
  if(!cat){alert("Please select a category!"); return;}
  categoryWords = allWords[cat];
  startBtn.style.display="none";
  categorySelect.style.display="none";
  canvas.style.display="block";
  document.getElementById('ui').style.display="flex";
  nextWord();
  spawnBalloonsLoop();
  startTimer();
  gameLoop();
});
</script>

<div id="gameFooter" style="position:fixed; bottom:10px; width:100%; text-align:center; font-size:16px; color:#333; font-family:Arial;">
  Game Developed by <a href="https://m-a-h-b-u-b.github.io" target="_blank" style="text-decoration:none; color:#0077cc;">Md Mahbubur Rahman</a>
</div>

</body>
</html>
